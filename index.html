<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu đồ cột và biểu đồ hình tròn</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h1>Biểu đồ</h1>
    <div class="chart-container" id="chartContainer">
        <!-- Các biểu đồ sẽ được tạo ra ở đây -->
    </div>

    <div class="pie-chart-container" id="pieChartContainer" style="display: none;">
        <canvas id="pieChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Thư viện cho biểu đồ hình tròn -->

    <script>
        let isBarChartVisible = true; // Biến theo dõi biểu đồ nào đang hiển thị
        let chartData = []; // Lưu trữ dữ liệu CSV
        let pieChartInstance = null; // Biến để lưu trữ biểu đồ hình tròn

        // Hàm để đọc tệp CSV và tạo biểu đồ
        function fetchData() {
            fetch('data.csv')  // Đường dẫn tới tệp CSV
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').slice(1); // Bỏ qua tiêu đề
                    chartData = rows.map(row => row.trim()); // Lưu dữ liệu để dùng cho cả hai biểu đồ
                    createBarChart();
                })
                .catch(error => console.error('Error fetching the CSV file:', error));
        }

        // Tạo biểu đồ cột
        function createBarChart() {
            const chartContainer = document.getElementById('chartContainer');
            chartContainer.innerHTML = ''; // Xóa nội dung cũ

            chartData.forEach(value => {
                if (value) {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = `${value}%`; // Chiều cao dựa trên giá trị
                    bar.innerHTML = `<span>${value}%</span>`;
                    chartContainer.appendChild(bar);
                }
            });
        }

        // Tạo biểu đồ hình tròn bằng thư viện Chart.js
        function createPieChart() {
            const ctx = document.getElementById('pieChart').getContext('2d');

            // Nếu biểu đồ hình tròn đã tồn tại, hủy nó trước khi tạo biểu đồ mới
            if (pieChartInstance) {
                pieChartInstance.destroy();
            }

            // Tạo biểu đồ mới và lưu trữ vào biến `pieChartInstance`
            pieChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: chartData.map((_, index) => `Value ${index + 1}`),
                    datasets: [{
                        label: 'Percentage',
                        data: chartData,
                        backgroundColor: ['#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Chuyển đổi biểu đồ giữa cột và hình tròn
        function toggleChart() {
            const barChartContainer = document.getElementById('chartContainer');
            const pieChartContainer = document.getElementById('pieChartContainer');

            if (isBarChartVisible) {
                barChartContainer.style.display = 'none';
                pieChartContainer.style.display = 'block';
                createPieChart(); // Tạo biểu đồ hình tròn
            } else {
                pieChartContainer.style.display = 'none';
                barChartContainer.style.display = 'flex';
                createBarChart(); // Tạo biểu đồ cột
            }

            isBarChartVisible = !isBarChartVisible; // Đảo ngược trạng thái
        }

        // Gọi hàm fetchData khi trang được tải
        window.onload = function() {
            fetchData();
            setInterval(toggleChart, 3000); // Chuyển đổi biểu đồ cứ sau 3 giây
        };
    </script>

</body>
</html>
